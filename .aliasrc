source_if_exists() { [[ -s $1 ]] && source $1 }

# environment variables
export PAGER=less
export EDITOR=vim

# force less to interpret raw control characters
export LESS=-FRX

# prevent git from searching for $HOME/.git
export GIT_CEILING_DIRECTORIES="${HOME}"

# java hack
# wmname LG3D
export AWT_TOOLKIT=MToolkit
# export _JAVA_AWT_WM_NONREPARENTING=1

# pythonbrew and rvm (python/ruby version managers)
source_if_exists "$HOME/.pythonbrew/etc/bashrc"
source_if_exists "$HOME/.rvm/scripts/rvm"

# python/ruby package paths
export PYTHONPATH=.:${HOME}/.python:${HOME}/.python/lib/python
export GEM_PATH=${HOME}/.gem/ruby/1.8
export CLASSPATH=.:${HOME}/.java/lib/\*
export PERL5LIB="${HOME}/.perl/share/perl/5.8.8/:${HOME}/.perl/lib/perl/5.8.8/"

# general python setup
export PYTHONSTARTUP=${HOME}/.pythonrc
export PIP_DOWNLOAD_CACHE=${HOME}/.pip/cache
export VIRTUALENV_DIR=${HOME}/.python/envs/
export WORKON_HOME=${VIRTUALENV_DIR}
source_if_exists "$HOME/.python/bin/virtualenvwrapper.sh"

# my subset of virtualenv for ruby
export GEMENV_HOME=${HOME}/.gem/envs
source_if_exists ${GEMENV_HOME}/gemenv_bashrc

if [[ -z ${PROMPT_HOST} ]]; then
    PROMPT_HOST=""
fi

# disable start/stop output control
stty -ixon

# aliases
alias dos2unix='recode dos/CR-LF..l1'
alias unix2win='recode l1..windows-1250'
alias unix2dos='recode l1..dos/CR-LF'

alias gri='git rebase --interactive'

# common programs
alias g='git'
alias h='hg'
alias p='python'
alias m='make'
alias j='jrun'

# common flags
alias ll='ls -l'
alias la='ls -a'
alias rr='rm -rf'
alias mi='mv -i'
alias vm='valgrind --leak-check=full'

# fixing my typos :D
alias sl='ls'
alias amke='make'

# do what I usually want to happen with regards to tmux, i.e.
# fix ssh-agent forwarding or attach or create a new session
ta() {
  # reload some of the environment variables for tmux
  # most notably this fixes ssh-agent forwarding
  if [[ -n "$TMUX" ]]; then
    fix_tmux_env
    return
  fi
  tmux attach "$@" || tmux new-session 'echo "= New TMUX session =" ; zsh'
}

# reload some of the environment variables for tmux
# most notably this fixes ssh-agent forwarding
fix_tmux_env() {
  if [[ -n $TMUX ]]; then
    eval $(tmux showenv | grep -vE "^-" | awk -F = '{print "export "$1"=\""$2"\""}')
    ssh-add -l
  fi
}

source_if_exists ${HOME}/.localrc

# vim: set ft=sh :
